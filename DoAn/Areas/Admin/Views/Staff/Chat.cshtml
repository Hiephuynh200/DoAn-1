@{
    ViewData["Title"] = "Index";
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
}

<div class="chat-container">
    <div>
        <label>Your Name:</label>
        <input type="text" id="displayname" value="@ViewBag.Username" readonly />
    </div>

    <div class="mt-5">
        <input type="text" id="message" />
        <input type="text" id="sendmessage" value="Send" />
    </div>

    <div class="mt-3">
        @if (!string.IsNullOrEmpty(ViewBag.Avatar))
        {
            <img src="@ViewBag.Avatar" alt="User Avatar" style="width: 50px; height: 50px; border-radius: 50%;" />
        }
        <ul id="discussion"></ul>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@@microsoft/signalr@3.1.12/dist/browser/signalr.min.js"></script>

<script>
    var connection = new signalR.HubConnectionBuilder().withUrl("/chat").build();

    connection.start().catch(function (err) {
        return console.error(err.toString());
    });

    document.getElementById("sendmessage").addEventListener("click", function (event) {
        var user = document.getElementById("displayname").value;
        var message = document.getElementById("message").value;

        connection.invoke("SendMessage", user, message, "@ViewBag.Avatar").catch(function (err) {
            return console.error(err.toString());
        });

        event.preventDefault();
    })

    connection.on("RevceiveMessage", function (user, message, avatar) {
        var encodeMsg = `<img src="${avatar}" alt="${user}'s Avatar" style="width: 20px; height: 20px; border-radius: 50%;" /> ${user}: ${message}`;
        var li = document.createElement("li");

        li.innerHTML = encodeMsg;
        document.getElementById("discussion").appendChild(li);
    })
</script>
<style>
    .chat-container {
        position: fixed;
        bottom: 10px;
        right: 10px;
        background-color: #fff;
        border: 1px solid #ccc;
        padding: 10px;
        max-width: 300px
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        max-height: 180px;
        overflow-y: auto;
    }

    .chat-container img {
        margin-right: 10px;
    }

    .message-list {
        list-style-type: none;
        padding: 0;
        margin: 0;
    }


</style>